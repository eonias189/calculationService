<h1>Установка</h1>

```
git clone https://github.com/eonias189/calculationService.git <path>

cd <path>
scripts/install
```
path - путь для установки

>Для установки необходим компилятор go, nodejs и yarn (yarn можно установить через `npm i -g yarn`)

<h1>Запуск</h1>

```
scripts/run-orchestrator
scripts/run-frontend
```

<h3>Для запуска агентов:</h3>

```
go run agent/cmd/main.go <port> <threads>
```

где port - четырёхзначное число (не 8081), threads - количество потоков агента

>Каждый скрипт нужно запускать в отдельном терминале. Агентов можно запустить несколько, но у них должны быть разные порты!

Сервер с оркестратором работает на http://loaclhost:8081

Сервер с фронтендом работает на http://localhost:3000

Сервера агентов работают на http://localhost:<port\>, где port - порт, с которым запущен агент


<h2>Взаимодействие с серверами</h2>
Эндпоинты для взаимодействия с серверами указаны в <a href="https://github.com/eonias189/calculationService/blob/main/endpoints.txt">endpoints.txt</a>

Протокол взаимодействия указан в <a href="https://github.com/eonias189/calculationService/blob/main/.proto">.proto</a>

Сервер с фронтендом имеет графический интерфейс для взаимодействия

>Если сервер агента был отключен во время выполнения задач, то перед тем, как подключать его обратно, необходимо дождаться, когда задачи, который выполнял этот агент, перейдут в режим ожидания (их цвет изменится на серый), иначе они не выполнятся никогда


<h1>Как Работает</h1>

Пользователь через сервер с фронтендом посылает на сервер оркестратора запросы на добавление задачи/изменение таймаутов/получение информации о задачах/агентах/таймаутах.</br>



Информацию о задачах/агентах/таймаутах оркестратор берёт из базы данных. В отдельном потоке оркестратор с определённым интервалом делает запросы к агентам, чтобы обновлять информацию о них. Также в отдельном потоке он проверяет ping агентов и при обнаружении отключенного агента изменяет статус всех задач, которые выполняет этот агент на "ожидание распределения".


Агенты в отдельном потоке с определённым интервалом (при наличии свободного потока для выполнения) делают запрос к оркестратору на получение новой задачи и после выполнения делают запрос на установление результата.
</br>

<h1>Возможные вопросы</h1>

<h3>Где документация к коду?</h3>

>Код написан по принципам самодокументирования

<h3>Зачем нужен модуль backend?</h3>

>В этом модуле хранится код, который используется и в модуле оркестратора, и в модуле агента
